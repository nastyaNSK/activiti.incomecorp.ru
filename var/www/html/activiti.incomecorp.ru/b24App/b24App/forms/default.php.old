<!DOCTYPE html>
<html lang="ru">
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
            crossorigin="anonymous"></script>
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <link href="<?=$BackUrl;?>css/style.css" rel="stylesheet">
    <style>



    </style>
    <title>База активити Income Media</title>
    <meta name="description" content="База активити Income Media" />
</head>
<body>
<ul class="nav nav-tabs" id="myTab" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home-tab-pane" type="button" role="tab" aria-controls="home-tab-pane" aria-selected="true">База активити</button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile-tab-pane" type="button" role="tab" aria-controls="profile-tab-pane" aria-selected="false">Поддержка</button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="about-tab" data-bs-toggle="tab" data-bs-target="#about-tab-pane" type="button" role="tab" aria-controls="about-tab-pane" aria-selected="false">Разработка</button>
    </li>
</ul>
<div class="tab-content" id="myTabContent">
    <div class="tab-pane fade show active" id="home-tab-pane" role="tabpanel" aria-labelledby="home-tab" tabindex="0">
        <div class="activity-wrap mt-3">
            <?
            foreach ($activity as $k=>$item) { ?>
                <div class="activity-block" id="act-<?=$item['activityCode'];?>">
                    <div class="activity-header">
                        <?=$item['activityName'];?>
                    </div>
                    <div class="activity-desc">
                        <?=$item['activityDescription'];?>
                        <div class="activity-detail">

                        </div>
                        <div class="button-disable" style="display: none">
                            <span class="act-link" onclick="act_disable('<?=$item['activityCode'];?>','<?= isset($item['activityMulti']);?>')">Удалить</span>
                        </div>
                        <div class="button-enable" >
                            <span class="act-link" onclick="act_enable('<?=$item['activityCode'];?>')">Установить</span>
                        </div>
                    </div>

                </div>
            <? } ?>
        </div>

    </div>

        <div class="tab-pane fade" id="profile-tab-pane" role="tabpanel" aria-labelledby="profile-tab" tabindex="0">

            <div class="support-wrap mt-3">
                <h3 style="margin-top: 15px;">Отправить запрос в техническую поддержку</h3>
                <form action="" id="support-request">
                    <input type="hidden" name="member_id" value="<?=$_REQUEST['member_id']?>">
                    <input type="hidden" name="DOMAIN" value="<?=$_REQUEST['DOMAIN']?>">
                    <div class="mb-3">
                        <p>Для обращения в поддержку заполните E-mail или телефон, после чего введите ваше обращение</p>
                        <label for="email" class="form-label">E-mail</label>
                        <input type="email" class="form-control" id="email" name="email" placeholder="name@example.com" required>
                        <label for="phone" class="form-label">Телефон</label>
                        <input type="phone" class="form-control" id="phone" name="phone" placeholder="+79628420000" required>
                    </div>
                    <div class="mb-3">
                        <label for="supportrequest" class="form-label">Ваше обращение</label>
                        <textarea class="form-control" id="supportrequest" name="supportrequest" rows="5"></textarea>
                        <sapn class="supportrequest_wrong" style="display: none">Попробуйте сформулировать свой вопрос подробнее</sapn>
                    </div>
                    <div>
                        <button class="btn btn-success">Отправить</button>
                    </div>
                </form>
                <div class="request-success" style="display: none;" >
                    <h3>Ваш запрос успешно отправлен</h3>
                    <p>В ближайшее время мы свяжемся с вами.</p>
                </div>
            </div>
        </div>
    <div class="tab-pane fade" id="about-tab-pane" role="tabpanel" aria-labelledby="about-tab" tabindex="0">
        <div class="about-wrap">
            <div class="about-title">
               <div>
                    <img src="<?=$BackUrl?>images/beaver.png" alt="">
                </div>
                <div>
                    <p>INCOM MEDIA -КОНСАЛТИНГ АВТОМАТИЗАЦИЯ СИНЕРГИЯ</p>
                    <p>МИССИЯ КОМПАНИИ - Быть надёжным партнёром и помощником для клиентов на пути к их величайшим достижениям в бизнесе.</p>
                </div>
            </div>
            <div class="about-text">
               <h5>ЧТО МЫ УМЕЕМ</h5>
                <hr>
                <p>- Профессионально внедрять Битрикс24;</p>
                <p>- Строить бизнес-процессы;</p>
                <p>- Создавать бизнес-процессы в Битрикс24;</p>
                <p>- Настраивать телефонию любой сложности;</p>
                <p>- Создавать приложения для Битрикс24;</p>
                <p>- Внедрять Битрикс24 в коробке;</p>
                <p>- Обучать работе в Битрикс24.</p>

                <br>
                <h5>КАК НАС НАЙТИ</h5>
                <hr>
                <p>Открытая линия в чате Битрикс24</p>
                <p>+7(812) xxxxxxx</p>
                <p>+7(499) xxxxxxx</p>
                <p></p>info@income-media.ru</p>
                <p><a href="https://income-media.ru/" target="_blank">income-media.ru</a> </p>

            </div>
        </div>
    </div>
</div>
<script>
    $("#supportrequest").on('focus', function() {
        $('#supportrequest').removeClass('supportrequest-invalid');
        $('.supportrequest_wrong').hide();
    });


    $('#support-request').on('submit', function(e) {
        e.preventDefault();

        let textLen =  $('#supportrequest').val().length;
        if(textLen < 20) {
            $('#supportrequest').addClass('supportrequest-invalid');
            $('.supportrequest_wrong').show();
            return;
        }

        var sendInfo = $(this).serialize();

        $.ajax({
            url:    '<?=$supportBackUrl ?>',
            type:     "POST",
            dataType: "json",
            data: sendInfo,
            success: function(response) {
                console.log(response);
                $("#support-request").hide();
                $(".request-success").show();
            },
            error: function(response) {

            }
        });

    });
</script>

    <script src="//api.bitrix24.com/api/v1/"></script>
    <script>
        BX24.init(function() {
            checkList();
        });
        function act_disable(act, multi) {
            console.log(multi);
            console.log((multi == "1"));
            if(multi == "1")
            {
                BX24.callMethod(
                    'bizproc.activity.delete',
                    {
                        'code' : "A." + act
                    },
                    function(result)
                    {
                        if(result.error())
                            alert('Error: ' + result.error());
                        else
                            $("#act-"+ act).removeClass("activity-enable");
                        $("#act-"+ act).find(".button-disable").hide();
                        $("#act-"+ act).find(".button-enable").show();
                    }
                );
                BX24.callMethod(
                    'bizproc.robot.delete',
                    {
                        'code' : "R." + act
                    },
                    function(result)
                    {
                        if(result.error())
                            alert('Error: ' + result.error());
                        else
                            $("#act-"+ act).removeClass("activity-enable");
                        $("#act-"+ act).find(".button-disable").hide();
                        $("#act-"+ act).find(".button-enable").show();
                    }
                );
            }else
            {
                BX24.callMethod(
                    'bizproc.activity.delete',
                    {
                        'code' : act
                    },
                    function(result)
                    {
                        if(result.error())
                            alert('Error: ' + result.error());
                        else
                            $("#act-"+ act).removeClass("activity-enable");
                        $("#act-"+ act).find(".button-disable").hide();
                        $("#act-"+ act).find(".button-enable").show();
                    }
                );
            }


        }
        function checkList() {
            BX24.callMethod(
                'bizproc.activity.list',
                {},
                function (result) {
                    if (result.error()){
                        //alert("Ошибка: " + result.error());
                    }else{
                        let items = result.data();

                        for (let key in items) {
                            let id = items[key].split('.');
                            if(id[1] === undefined) {
                                id[1] = items[key];
                            }
                            console.log(id[1]);
                            $("#act-"+ id[1]).addClass("activity-enable");
                            $("#act-"+ id[1]).find(".button-disable").show();
                            $("#act-"+ id[1]).find(".button-enable").hide();
                        }
                    }
                }
            );
        }

        function act_enable(act) {
            sendInfo = {
                'member_id' : '<?=$_REQUEST['member_id'] ?>',
                'code' : act,
            }

            $.ajax({
                url:    '<?=$handlerBackUrl ?>',
                type:     "POST",
                dataType: "json",
                data: sendInfo,
                success: function(response) {
                    console.log(response);
                    checkList();
                },
                error: function(response) {

                }
            });
        }


    </script>
    <script>
        (function(w,d,u){
            var s=d.createElement('script');s.async=true;s.src=u+'?'+(Date.now()/60000|0);
            var h=d.getElementsByTagName('script')[0];h.parentNode.insertBefore(s,h);
        })(window,document,'https://work.income-media.ru/upload/crm/site_button/loader_1_nbwetz.js');
    </script>

</body>
</html>